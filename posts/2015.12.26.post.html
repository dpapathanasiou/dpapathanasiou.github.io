<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Apples and Oranges? | The personal web site of Denis Papathanasiou">
    <meta name="author" content="Denis Papathanasiou">
    <title>Go Concurrency versus C and pthreads</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link href="../css/my-blog.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

  <a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
  <nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
      <li class="sidebar-brand"><a href="../" onclick="$('#menu-close').click();" >Denis Papathanasiou</a></li>
      <li class="sidebar-brand"><a href="../aikido.html" onclick="$('#menu-close').click();" >aikido</a></li>
      <li class="sidebar-brand"><a href="../hardware.html" onclick="$('#menu-close').click();" >hardware</a></li>
      <li class="sidebar-brand"><a href="../programming.html" onclick="$('#menu-close').click();" >programming</a></li>
      <li class="sidebar-brand"><a href="../random.html" onclick="$('#menu-close').click();" >random</a></li>
      <li class="sidebar-brand"><a href="../technology.html" onclick="$('#menu-close').click();" >technology</a></li>
      <li class="sidebar-brand"><a href="../#contacts" onclick="$('#menu-close').click();" >contact</a></li>
    </ul>
  </nav>


  <header class="intro-header" style="background-image: url('/img/X11-120cpu.jpg')"> <!-- source: https://commons.wikimedia.org/wiki/File:X11-120cpu.jpg -->
    <div class="container">
      <div class="row">
	<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <div class="site-heading" style="color:#ff6c02">
	    <h1>Go Concurrency versus C and pthreads</h1>
	    <hr class="small">
	    <h2 class="subheading">Apples and Oranges?</h2>
	    <p class="post-meta"><i class="fa fa-calendar"></i> December 26, 2015</p>

	  </div>
	</div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<p>
I recently participated in the following programming challenge:
</p>

<p style="padding-left:0.5em;border-left:2px solid #ff0000"><tt>
Write a program to test user reflexes: when it runs, it waits a random amount of time between 1 and 10 seconds, and prints "GO!" as a prompt.
<br /><br />

It then expects the user to hit the enter key, and times how fast enter is pressed, in milliseconds.
<br /><br />

If the enter key is pressed before the "GO!" prompt appears, the program prints "FAIL".
</tt></p>

<p>
It's essentially an exercise in <a href="https://en.wikipedia.org/wiki/Concurrency_%28computer_science%29" target="_blank">concurrency</a>: have one piece of logic listen to the keyboard, for the key press, while simultaneously generating a random number for the sleep duration, and finally comparing the event timestamps.
</p>

<p>
Since I have been learning <a href="https://golang.org/" target="_blank">Go</a>, the "GO!" prompt in the challenge description led me to think of using <a href="https://golang.org/doc/effective_go.html#goroutines" target="_blank">goroutines</a> and <a href="https://golang.org/doc/effective_go.html#channels" target="_blank">channels</a> to solve it.
</p>

<p>
As it turns out, doing it this way is pretty easy:
</p>

<script src="https://gist.github.com/dpapathanasiou/0b013d2e5262d56a9f75.js"></script>

<p>
Then I started thinking about how <a href="https://en.wikipedia.org/wiki/Go_%28programming_language%29#Language_design" target="_blank">Go was influenced by C</a>, or the idea that &quot;<a href="http://thenewstack.io/a-closer-look-at-golang-from-an-architects-perspective/" target="_blank">Go is a modern C</a>&quot;, and wondered how difficult would it be to reproduce the same program in plain C?
</p>

<p>
There are no references to threads in the <a href="http://flash-gordon.me.uk/ansi.c.txt" target="_blank">original ANSI C specification</a> nor even in the <a rel="nofollow" href="http://www.amazon.com/gp/product/0131103628/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=0131103628&linkCode=as2&tag=denispapath-20&linkId=YZU35D35AZNKMNHE" target="_blank">second edition of K &amp; R</a><img src="http://ir-na.amazon-adsystem.com/e/ir?t=denispapath-20&l=as2&o=1&a=0131103628" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />, but <a href="https://computing.llnl.gov/tutorials/pthreads/" target="_blank">POSIX threads</a>, or pthreads, have come along since then, as an optional library.
</p>

<p>
While it's a bit more verbose, conceptually it is very similar:
</p>

<script src="https://gist.github.com/dpapathanasiou/7fb9884aa315b682611a.js"></script>

<p>
Listening for key press events is essentially the same, and <a href="http://linux.die.net/man/2/gettimeofday" target="_blank">gettimeofday</a> provides nice time capture and compare functions, similar to Go's <a href="https://golang.org/pkg/time/" target="_blank">time package</a>.
</p>

<p>
Creating a pthread is relatively straight-forward, but instead of using a channel to communicate a result, I had to <a href="http://beej.us/guide/bgc/output/html/multipage/pointers.html#ptpass" target="_blank">pass a struct by reference</a>.
</p>

<p>
The other big difference is that the created pthread has to be <a href="https://computing.llnl.gov/tutorials/pthreads/man/pthread_join.txt" target="_blank">joined</a>, to wait on its termination.
</p>

<p>
<a href="http://timmurphy.org/2010/05/04/pthreads-in-c-a-minimal-working-example/" target="_blank">This example</a>, with its detailed explanations, was invaluable for wrapping my mind around how pthreads work.
</p>

<p>
Both the create and join event are fragile, though, and need to be monitored for errors. In this toy program, I just exit if either of those things happen, but it would cause real complexity for a more serious application.
</p>

<p>
Programming logic aside, there is another distinction with what's happening under the hood.
</p>

<p>
While pthreads are lighter-weight than full blown operating system processes, they are still much more resource intensive than goroutines. Go's concurrency is based on the <a href="http://www.usingcsp.com/" target="_blank">Communicating Sequential Processes (CSP) model</a>.
</p>

<p>
As a result, its <a href="https://tleyden.github.io/blog/2014/10/30/goroutines-vs-threads/" target="_blank">goroutines are multiplexed to a small number of operating system threads</a>, instead of using one thread for each goroutine.
</p>

<p>
<a href="http://www.erlang.org/" target="_blank">Erlang</a>, which also uses CSP, claims <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.116.1969&rep=rep1&type=pdf" target="_blank">similar scalability</a> with its design. 
</p>

<p>
But perhaps this is an unfair comparison: C is much older than Go, and pthreads were a later add-on.
</p>

<p>
Go, in contrast, had the benefit of C's experience, alongside other developments in CS theory and practice.
</p>

        <hr>
      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
	<a name="contacts"></a>
	<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <ul class="list-inline text-center">
	    <li>
	      <a href="mailto:denis@papathanasiou.org">
		<span class="fa-stack fa-lg">
		  <i class="fa fa-circle fa-stack-2x"></i>
		  <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
		</span>
	      </a>
	    </li>
	    <li>
	      <a href="https://github.com/dpapathanasiou">
		<span class="fa-stack fa-lg">
		  <i class="fa fa-circle fa-stack-2x"></i>
		  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
		</span>
	      </a>
	    </li>
	  </ul>
	</div>
      </div>
      <div class="row">
	<a name="license"></a>
	<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <p class="copyright text-muted">
	    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a> &nbsp;
	    This site's content is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons (BY-NC-SA 4.0)</a>
	  </p>
	</div>
      </div>
    </div>
  </footer>

  <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="../js/my-blog.min.js"></script>
  
</body>
</html>


