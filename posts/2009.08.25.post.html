<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content=" | The personal web site of Denis Papathanasiou">
    <meta name="author" content="Denis Papathanasiou">
    <title>Using Mercurial on Shared Web Hosting</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
    <link href="../css/my-blog.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

  <a id="menu-toggle" href="#" class="btn btn-dark btn-lg toggle"><i class="fa fa-bars"></i></a>
  <nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <a id="menu-close" href="#" class="btn btn-light btn-lg pull-right toggle"><i class="fa fa-times"></i></a>
      <li class="sidebar-brand"><a href="../" onclick="$('#menu-close').click();" >Denis Papathanasiou</a></li>
      <li class="sidebar-brand"><a href="../aikido.html" onclick="$('#menu-close').click();" >aikido</a></li>
      <li class="sidebar-brand"><a href="../hardware.html" onclick="$('#menu-close').click();" >hardware</a></li>
      <li class="sidebar-brand"><a href="../programming.html" onclick="$('#menu-close').click();" >programming</a></li>
      <li class="sidebar-brand"><a href="../random.html" onclick="$('#menu-close').click();" >random</a></li>
      <li class="sidebar-brand"><a href="../technology.html" onclick="$('#menu-close').click();" >technology</a></li>
      <li class="sidebar-brand"><a href="../#contacts" onclick="$('#menu-close').click();" >contact</a></li>
    </ul>
  </nav>


  <header class="intro-header" style="background-image: url('/img/source-code-bg.jpg')"> <!-- source: https://pixabay.com/en/source-code-code-programming-c-583537/ -->
    <div class="container">
      <div class="row">
	<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <div class="site-heading" style="color:#00ff00">
	    <h1>Using Mercurial on Shared Web Hosting</h1>
	    <hr class="small">
	    <h2 class="subheading"></h2>
	    <p class="post-meta"><i class="fa fa-calendar"></i> August 25, 2009</p>

	  </div>
	</div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
<p><a href='http://www.selenic.com/mercurial/'>Mercurial</a> is a distributed version control system.</p>

<p>Combine it with <a href='http://en.wikipedia.org/wiki/Secure_Shell'>ssh</a>, and it's easy to make backups to any server, local or remote.</p>

<p>In theory, the 'hg + ssh' combination will work on any remote server, even shared (i.e., cheap) web hosting accounts.</p>

<p>But some web hosts don't support Mercurial, and their admins might be less than willing to install it for you.</p>

<p>So here's how to get around that problem (for this example, I'm assuming you have ssh access to your web host account, that the web hosting OS is some flavor of Linux):</p>

<p>(1) Download the Mercurial source code:</p>

<pre>
$ wget <a href='wget http://mercurial.selenic.com/release/mercurial-1.3.1.tar.gz'>http://mercurial.selenic.com/release/mercurial-1.3.1.tar.gz</a>
</pre>

(2) Unpack, and install using the "<b>Per-user installation</b>" instructions from the <a href='http://mercurial.selenic.com/wiki/UnixInstall'>unix install guide</a>, i.e.:

<pre>
$ make install-home                     # add PYTHON=/path/to/python2.3-or-newer if necessary
$ export PYTHONPATH=${HOME}/lib/python  # bash syntax, ymmv
$ export PATH=${HOME}/bin:$PATH         # add these to your .bashrc
</pre>

Now, with .bashrc updated to include ~/lib/python in $PYTHONPATH and ~/bin in $PATH, running Mercurial at the prompt should work:

<pre>
$ hg version
Mercurial Distributed SCM (version 1.3.1)

Copyright (C) 2005-2009 Matt Mackall <mpm@selenic.com> and others
This is free software; see the source for copying conditions. There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
</pre>

<p>Next, the hard part: getting ssh in non-interactive mode (which is how hg uses it to push/pull/clone/etc.) to recognize the newly updated .bashrc.</p>

<p><a href='http://blogs.sun.com/jmxetc/entry/using_mercurial_with_ssh'>This post</a> suggested a way around the problem:</p>

<blockquote>
    * Create (or edit it if it already exists) a file named ~/.ssh/environment<br />
    * and put this line inside:<br />
<br />
   ENV=~/.kshrc<br />
<br />
This will make ssh export the ENV variable before calling ksh. In non interactive mode, ksh will source the file pointed to by the ENV variable. (see man ksh for more details).
</blockquote>

<p>Using a ~/.ssh/environment file, though, requires that <a href='http://www.raphink.info/2008/09/forcing-environment-in-ssh.html'>PermitUserEnvironment in sshd_config is set to "yes"</a>.</p>

<p>Unfortunately, the admins running my particular web host account did not have "PermitUserEnvironment" set to yes, and they wouldn't change it, for "security" reasons.</p>

<p>The answer turned out to be: <span style="background-color:#ffff99">use the <tt>--remotecmd</tt> option in hg to explicitly source .bashrc</span> before attempting to run hg itself. </p>

<p>So, for example, a pull from the remote server would look like this:</p>

<p><tt>$ hg pull --remotecmd='source ./.bashrc; hg' ssh://username@server/path/to/repository</tt></p>

<p>Using <tt>--remotecmd</tt> will avoid the "<tt>remote: bash: hg:  not found</tt>" error.</p>
        <hr>
      </div>
    </div>
  </div>

  <hr>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="row">
	<a name="contacts"></a>
	<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <ul class="list-inline text-center">
	    <li>
	      <a href="mailto:denis@papathanasiou.org">
		<span class="fa-stack fa-lg">
		  <i class="fa fa-circle fa-stack-2x"></i>
		  <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
		</span>
	      </a>
	    </li>
	    <li>
	      <a href="https://github.com/dpapathanasiou">
		<span class="fa-stack fa-lg">
		  <i class="fa fa-circle fa-stack-2x"></i>
		  <i class="fa fa-github fa-stack-1x fa-inverse"></i>
		</span>
	      </a>
	    </li>
	  </ul>
	</div>
      </div>
      <div class="row">
	<a name="license"></a>
	<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	  <p class="copyright text-muted">
	    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a> &nbsp;
	    This site's content is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons (BY-NC-SA 4.0)</a>
	  </p>
	</div>
      </div>
    </div>
  </footer>

  <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
  <script src="../js/my-blog.min.js"></script>
  
</body>
</html>


